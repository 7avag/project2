# project2

–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ Python + Aiogram. –ë–æ—Ç —Ö—Ä–∞–Ω–∏—Ç –∑–∞–º–µ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ JSON, –≤—ã–¥–∞—ë—Ç —à—É—Ç–∫–∏ (—Ä—É—Å—Å–∫–∏–µ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏ –¥–∞—ë—Ç –∞–¥–º–∏–Ω—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –ê–≤—Ç–æ—Ä—ã: –®–æ—Ä–æ—Ö–æ–≤ –í–ª–∞–¥–∏–º–∏—Ä 472680 –®–∞–ø–æ–≤–∞–ª–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è 468062



## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞


config/              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—á—Ç–µ–Ω–∏–µ .env)
filters/             # –§–∏–ª—å—Ç—Ä—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞)
keyboards/           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  ‚îú‚îÄ builders.py     # –§–æ—Ä–º–∏—Ä—É–µ—Ç ReplyKeyboard (–∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é)
  ‚îî‚îÄ inline.py       # –§–æ—Ä–º–∏—Ä—É–µ—Ç InlineKeyboard (–¥–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–º–µ—Ç–∫–∞–º–∏)
locales/             # JSON-—Ñ–∞–π–ª—ã —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ (ru.json, en.json)
middlewares/         # –ê–Ω—Ç–∏—Å–ø–∞–º
routers/             # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –∫–æ–ª–±—ç–∫–æ–≤
  ‚îî‚îÄ commands.py     # –õ–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º
services/            # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
  ‚îî‚îÄ api_client.py   # –ó–∞–ø—Ä–æ—Å —à—É—Ç–æ–∫ —á–µ—Ä–µ–∑ HTTP + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
states/              # 
  ‚îî‚îÄ notes_state.py  # –û–ø–∏—Å–∞–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫
storage/             # –•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–º–µ—Ç–æ–∫
  ‚îî‚îÄ storage.json    # 
utils/               # –£—Ç–∏–ª–∏—Ç—ã
  ‚îú‚îÄ formatters.py   # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏ (–¥–∞—Ç–∞/–≤—Ä–µ–º—è)
  ‚îî‚îÄ logger.py       # –õ–æ–≥–≥–µ—Ä (–∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª)
bot.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: —Å–æ–∑–¥–∞—ë—Ç Bot, Dispatcher, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–æ—É—Ç–µ—Ä—ã
.env.example         # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω, –∞–¥–º–∏–Ω—ã –∏ —Ç.–¥.)
requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (aiogram, aiohttp, aiocache...)
README.md            # –≠—Ç–æ—Ç —Ñ–∞–π–ª: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏


## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª

**config/settings.py**

* –ß–∏—Ç–∞–µ—Ç `.env` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è python-dotenv).
* –°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è: `BOT_TOKEN`, `ADMINS` (—Å–ø–∏—Å–æ–∫ user\_id), `API_TIMEOUT`, `CACHE_TTL`.
* –ò–∑–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å –º–æ–∂–Ω–æ: –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∞–π–º–∞—É—Ç–∞ –∏ –∫—ç—à–∞, –ø–µ—Ä–µ—á–µ–Ω—å –∞–¥–º–∏–Ω–æ–≤.

**filters/admin\_filter.py**

* –ö–ª–∞—Å—Å `IsAdminFilter`: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ `ADMINS`. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∫–æ–º–∞–Ω–¥–∞–º `/broadcast` –∏ `/stats`.

**keyboards/builders.py**

* –§—É–Ω–∫—Ü–∏—è `main_menu(lang)`: —Å–æ–∑–¥–∞—ë—Ç ReplyKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏ –º–µ–Ω—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ("–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏", "–®—É—Ç–∫–∞", "–Ø–∑—ã–∫", "–ü–æ–º–æ—â—å").

**keyboards/inline.py**

* –§—É–Ω–∫—Ü–∏—è `note_actions_keyboard(lang)`: —Å–æ–∑–¥–∞—ë—Ç InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É", "–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É", "–û—Ç–º–µ–Ω–∞" (–∏–ª–∏ –∞–Ω–≥–ª. "Add note", "Delete note", "Cancel").

**locales/ru.json** –∏ **locales/en.json**

* –•—Ä–∞–Ω—è—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ñ—Ä–∞–∑—ã (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, —Å–ø—Ä–∞–≤–∫–∞, –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫, –æ—à–∏–±–∫–∏, —Ç–µ–∫—Å—Ç—ã —Ä–∞—Å—Å—ã–ª–∫–∏).

**middlewares/throttling.py**

* –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∫–æ–º–∞–Ω–¥ (–∞–Ω—Ç–∏—Å–ø–∞–º). –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã.

**routers/commands.py**

* –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞:

  * `/start`: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `lang="ru"`, –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
  * `/help`: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –∏–∑ `locales` (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç `lang`).
  * `/joke`: –µ—Å–ª–∏ `lang=="en"` –∏–ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "ü§£ Joke", –±–µ—Ä—ë—Ç —à—É—Ç–∫—É –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API (`api_client`) –∏ –∫—ç—à–∏—Ä—É–µ—Ç; –∏–Ω–∞—á–µ —Å–ª—É—á–∞–π–Ω–∞—è —Ä—É—Å—Å–∫–∞—è.
  * `/language`: –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –º–µ–∂–¥—É "ru" –∏ "en", —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ FSM, –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.
  * `/notes`: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ `user_id` –≤ JSON), –≤—ã–≤–æ–¥–∏—Ç Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π.
  * –ö–æ–ª–±—ç–∫–∏ `add_note`, `delete_note`, `cancel`: –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ ID, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç/—É–¥–∞–ª—è—é—Ç –∑–∞–º–µ—Ç–∫–∏.
  * `/broadcast <text>`: –∞–¥–º–∏–Ω—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞, –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ—Ö `user_id` –∏–∑ `storage.json`, —à–ª—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å—á–∏—Ç–∞–µ—Ç `sent`/`failed`.
  * `/stats`: –∞–¥–º–∏–Ω—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `len(db["users"])`.

**services/api\_client.py**

* –ö–ª–∞—Å—Å `APIClient` —Å –º–µ—Ç–æ–¥–æ–º `get_random_joke`: –¥–µ–ª–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –∫ `Chuck Norris API`, –∫—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`aiocache`).

**states/notes\_state.py**

* –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è : `WAITING_FOR_NOTE_TEXT` –∏¬†`WAITING_FOR_DELETE_ID`.

**storage/storage.json**

* –ì–ª–∞–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–º–µ—Ç–æ–∫, —Ñ–æ—Ä–º–∞—Ç:

  json
  { "users": { "<user_id>": [ { "id": 1, "text": "...", "timestamp": "..." }, ... ] } }
  

**utils/formatters.py**

* –§—É–Ω–∫—Ü–∏—è `format_note`: —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å –∑–∞–º–µ—Ç–∫–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ (ID, —Ç–µ–∫—Å—Ç, –¥–∞—Ç–∞/–≤—Ä–µ–º—è).

**utils/logger.py**

* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `logging`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–∏—à–µ—Ç –≤ —Ñ–∞–π–ª `bot.log` –∏/–∏–ª–∏ –≤ –∫–æ–Ω—Å–æ–ª—å.

**bot.py**

* –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞:

  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç `.env`, —Å–æ–∑–¥–∞—ë—Ç `Bot(token)`, `Dispatcher` —Å `MemoryStorage`.
  2. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç `ThrottlingMiddleware`, `IsAdminFilter`, –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–æ—É—Ç–µ—Ä `commands`.
  3. –ó–∞–ø—É—Å–∫–∞–µ—Ç `dp.start_polling(bot)`.

**requirements.txt**

* –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

  aiogram
  aiohttp
  aiocache
  python-dotenv


**.env.example**

* –®–∞–±–ª–æ–Ω –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ —Å–ª–∏—Ç—å —Ç–æ–∫–µ–Ω.


### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å** –ø—Ä–æ–µ–∫—Ç.
2. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

   
   python -m venv venv
   source venv/bin/activate  # –∏–ª–∏ .\venv\Scripts\activate –¥–ª—è Windows
   
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   
   pip install -r requirements.txt
   
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.example` ‚Üí `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å:

   
   BOT_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>
   ADMINS=<–≤–∞—à–∏_ID>
   API_TIMEOUT=10
   CACHE_TTL=60
   
   BOT_TOKEN –Ω—É–∂–Ω–æ –±—Ä–∞—Ç—å —É @BotFather
   –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å ID —Å–≤–æ–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –¢–µ–ª–µ–≥—Ä–∞–º, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –±–æ—Ç–æ–º @userinfobot
   
5. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `storage/storage.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤–Ω—É—Ç—Ä–∏:

   json
   { "users": {} }
   
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:

   
   python bot.py
   
7. –í Telegram –Ω–∞–∂–∞—Ç—å ¬´Start¬ª (–∏–ª–∏ `/start`), –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã.
